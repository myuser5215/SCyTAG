configuration:
  nodes:
  - name: CoreRouterA
    commands:
    - uci set system.@system[0].hostname='OpenWrt'
    - uci set system.@system[0].timezone='UTC'
    - uci commit system
    - echo > /etc/config/network
    - echo > /etc/config/firewall
    - echo > /etc/config/dhcp
    - uci set network.loopback='interface'
    - uci set network.loopback.device='lo'
    - uci set network.loopback.proto='static'
    - uci set network.loopback.ipaddr='127.0.0.1'
    - uci set network.loopback.netmask='255.0.0.0'
    - uci set network.globals='globals'
    - uci set network.globals.ula_prefix='fd51:c653:7b8d::/48'
    - uci set network.wan='interface'
    - uci set network.wan.ifname='eth0'
    - uci set network.wan.proto='static'
    - uci set network.wan.ipaddr='203.0.113.253'
    - uci set network.wan.netmask='255.255.255.0'
    - uci set network.wan.gateway='203.0.113.1'
    - uci set network.floor1='interface'
    - uci set network.floor1.ifname='eth1'
    - uci set network.floor1.proto='static'
    - uci set network.floor1.ipaddr='10.0.1.1'
    - uci set network.floor1.netmask='255.255.255.252'
    - uci set network.floor2='interface'
    - uci set network.floor2.ifname='eth2'
    - uci set network.floor2.proto='static'
    - uci set network.floor2.ipaddr='10.0.2.1'
    - uci set network.floor2.netmask='255.255.255.252'
    - uci set network.floor3='interface'
    - uci set network.floor3.ifname='eth3'
    - uci set network.floor3.proto='static'
    - uci set network.floor3.ipaddr='10.0.3.1'
    - uci set network.floor3.netmask='255.255.255.252'
    - uci set network.floor4='interface'
    - uci set network.floor4.ifname='eth4'
    - uci set network.floor4.proto='static'
    - uci set network.floor4.ipaddr='10.0.4.1'
    - uci set network.floor4.netmask='255.255.255.252'
    - uci set network.cloud='interface'
    - uci set network.cloud.ifname='eth0'
    - uci set network.cloud.proto='static'
    - uci set network.cloud.ipaddr='203.0.113.253'
    - uci set network.cloud.netmask='255.255.255.0'
    - uci set network.cloud.gateway='203.0.113.1'
    - uci add network route
    - uci set network.@route[-1].interface='floor1'
    - uci set network.@route[-1].target='10.2.1.0'
    - uci set network.@route[-1].netmask='255.255.255.252'
    - uci set network.@route[-1].gateway='10.0.1.2'
    - uci add network route
    - uci set network.@route[-1].interface='floor2'
    - uci set network.@route[-1].target='10.2.2.0'
    - uci set network.@route[-1].netmask='255.255.255.252'
    - uci set network.@route[-1].gateway='10.0.2.2'
    - uci add network route
    - uci set network.@route[-1].interface='floor3'
    - uci set network.@route[-1].target='10.2.3.0'
    - uci set network.@route[-1].netmask='255.255.255.252'
    - uci set network.@route[-1].gateway='10.0.3.2'
    - uci add network route
    - uci set network.@route[-1].interface='floor4'
    - uci set network.@route[-1].target='10.2.4.0'
    - uci set network.@route[-1].netmask='255.255.255.252'
    - uci set network.@route[-1].gateway='10.0.4.2'
    - uci set network.caldera_route='route'
    - uci set network.caldera_route.interface='wan'
    - uci set network.caldera_route.target='172.18.0.0'
    - uci set network.caldera_route.netmask='255.255.255.0'
    - uci set network.caldera_route.gateway='10.0.4.2'
    - uci commit network
    - uci add dhcp dnsmasq
    - uci set dhcp.@dnsmasq[0].domainneeded='1'
    - uci set dhcp.@dnsmasq[0].boguspriv='1'
    - uci set dhcp.@dnsmasq[0].filterwin2k='0'
    - uci set dhcp.@dnsmasq[0].localise_queries='1'
    - uci set dhcp.@dnsmasq[0].rebind_protection='1'
    - uci set dhcp.@dnsmasq[0].rebind_localhost='1'
    - uci set dhcp.@dnsmasq[0].local='/lan/'
    - uci set dhcp.@dnsmasq[0].domain='lan'
    - uci set dhcp.@dnsmasq[0].expandhosts='1'
    - uci set dhcp.@dnsmasq[0].nonegcache='0'
    - uci set dhcp.@dnsmasq[0].cachesize='1000'
    - uci set dhcp.@dnsmasq[0].authoritative='1'
    - uci set dhcp.@dnsmasq[0].readethers='1'
    - uci set dhcp.@dnsmasq[0].leasefile='/tmp/dhcp.leases'
    - uci set dhcp.@dnsmasq[0].resolvfile='/tmp/resolv.conf.d/resolv.conf.auto'
    - uci set dhcp.@dnsmasq[0].nonwildcard='1'
    - uci set dhcp.@dnsmasq[0].localservice='1'
    - uci set dhcp.@dnsmasq[0].ednspacket_max='1232'
    - uci set dhcp.@dnsmasq[0].filter_aaaa='0'
    - uci set dhcp.@dnsmasq[0].filter_a='0'
    - uci set dhcp.lan='dhcp'
    - uci set dhcp.lan.interface='lan'
    - uci set dhcp.lan.start='100'
    - uci set dhcp.lan.limit='150'
    - uci set dhcp.lan.leasetime='12h'
    - uci set dhcp.lan.dhcpv4='server'
    - uci set dhcp.lan.dhcpv6='server'
    - uci set dhcp.lan.ra='server'
    - uci set dhcp.lan.ra_slaac='1'
    - uci add_list dhcp.lan.ra_flags='managed-config'
    - uci add_list dhcp.lan.ra_flags='other-config'
    - uci set dhcp.wan='dhcp'
    - uci set dhcp.wan.interface='wan'
    - uci set dhcp.wan.ignore='1'
    - uci set dhcp.odhcpd='odhcpd'
    - uci set dhcp.odhcpd.maindhcp='0'
    - uci set dhcp.odhcpd.leasefile='/tmp/hosts/odhcpd'
    - uci set dhcp.odhcpd.leasetrigger='/usr/sbin/odhcpd-update'
    - uci set dhcp.odhcpd.loglevel='4'
    - uci commit dhcp
    - uci add firewall defaults
    - uci set firewall.@defaults[0].syn_flood='1'
    - uci set firewall.@defaults[0].input='REJECT'
    - uci set firewall.@defaults[0].output='ACCEPT'
    - uci set firewall.@defaults[0].forward='REJECT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='lan'
    - uci set firewall.@zone[-1].network='floor1 floor2 floor3 floor4'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='ACCEPT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='wan'
    - uci set firewall.@zone[-1].network='wan'
    - uci set firewall.@zone[-1].input='REJECT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci set firewall.@zone[-1].masq='1'
    - uci set firewall.@zone[-1].mtu_fix='1'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='lan'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='caldera'
    - uci set firewall.@zone[-1].network='caldera'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='caldera'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCP-Renew'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='68'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IGMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='igmp'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCPv6'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='546'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-MLD'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].src_ip='fe80::/10'
    - uci add_list firewall.@rule[-1].icmp_type='130/0'
    - uci add_list firewall.@rule[-1].icmp_type='131/0'
    - uci add_list firewall.@rule[-1].icmp_type='132/0'
    - uci add_list firewall.@rule[-1].icmp_type='143/0'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Input'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci add_list firewall.@rule[-1].icmp_type='router-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='router-advertisement'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-advertisement'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Forward'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IPSec-ESP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].proto='esp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping-LAN-to-WAN'
    - uci set firewall.@rule[-1].src='lan'
    - uci set firewall.@rule[-1].dest='wan'
    - uci set firewall.@rule[-1].dest_port='500'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci commit firewall
    - /etc/init.d/network restart
    - /etc/init.d/firewall restart
    - /etc/init.d/dnsmasq restart
    - /etc/init.d/odhcpd restart
  - name: CoreRouterE
    commands:
    - uci set system.@system[0].hostname='OpenWrt'
    - uci set system.@system[0].timezone='UTC'
    - uci commit system
    - echo > /etc/config/network
    - echo > /etc/config/firewall
    - echo > /etc/config/dhcp
    - uci set network.loopback='interface'
    - uci set network.loopback.device='lo'
    - uci set network.loopback.proto='static'
    - uci set network.loopback.ipaddr='127.0.0.1'
    - uci set network.loopback.netmask='255.0.0.0'
    - uci set network.globals='globals'
    - uci set network.globals.ula_prefix='fdd8:36e9:aa00::/48'
    - uci add network device
    - uci set network.@device[-1].name='br-lan'
    - uci set network.@device[-1].type='bridge'
    - uci add_list network.@device[-1].ports='eth0'
    - uci set network.wan='interface'
    - uci set network.wan.ifname='eth0'
    - uci set network.wan.proto='static'
    - uci set network.wan.ipaddr='10.0.4.2'
    - uci set network.wan.netmask='255.255.255.0'
    - uci set network.wan.gateway='10.0.4.1'
    - uci set network.lan='interface'
    - uci set network.lan.ifname='eth1'
    - uci set network.lan.proto='static'
    - uci set network.lan.ipaddr='10.1.4.1'
    - uci set network.lan.netmask='255.255.255.0'
    - uci add network route
    - uci set network.@route[-1].interface='lan'
    - uci set network.@route[-1].target='10.2.4.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.1.4.2'
    - uci add network route
    - uci set network.@route[-1].interface='wan'
    - uci set network.@route[-1].target='0.0.0.0'
    - uci set network.@route[-1].netmask='0.0.0.0'
    - uci set network.@route[-1].gateway='10.0.4.1'
    - uci commit network
    - uci add dhcp dnsmasq
    - uci set dhcp.@dnsmasq[0].domainneeded='1'
    - uci set dhcp.@dnsmasq[0].boguspriv='1'
    - uci set dhcp.@dnsmasq[0].filterwin2k='0'
    - uci set dhcp.@dnsmasq[0].localise_queries='1'
    - uci set dhcp.@dnsmasq[0].rebind_protection='1'
    - uci set dhcp.@dnsmasq[0].rebind_localhost='1'
    - uci set dhcp.@dnsmasq[0].local='/lan/'
    - uci set dhcp.@dnsmasq[0].domain='lan'
    - uci set dhcp.@dnsmasq[0].expandhosts='1'
    - uci set dhcp.@dnsmasq[0].nonegcache='0'
    - uci set dhcp.@dnsmasq[0].cachesize='1000'
    - uci set dhcp.@dnsmasq[0].authoritative='1'
    - uci set dhcp.@dnsmasq[0].readethers='1'
    - uci set dhcp.@dnsmasq[0].leasefile='/tmp/dhcp.leases'
    - uci set dhcp.@dnsmasq[0].resolvfile='/tmp/resolv.conf.d/resolv.conf.auto'
    - uci set dhcp.@dnsmasq[0].nonwildcard='1'
    - uci set dhcp.@dnsmasq[0].localservice='1'
    - uci set dhcp.@dnsmasq[0].ednspacket_max='1232'
    - uci set dhcp.@dnsmasq[0].filter_aaaa='0'
    - uci set dhcp.@dnsmasq[0].filter_a='0'
    - uci set dhcp.lan='dhcp'
    - uci set dhcp.lan.interface='lan'
    - uci set dhcp.lan.start='100'
    - uci set dhcp.lan.limit='150'
    - uci set dhcp.lan.leasetime='12h'
    - uci set dhcp.lan.dhcpv4='server'
    - uci set dhcp.lan.dhcpv6='server'
    - uci set dhcp.lan.ra='server'
    - uci set dhcp.lan.ra_slaac='1'
    - uci add_list dhcp.lan.ra_flags='managed-config'
    - uci add_list dhcp.lan.ra_flags='other-config'
    - uci set dhcp.wan='dhcp'
    - uci set dhcp.wan.interface='wan'
    - uci set dhcp.wan.ignore='1'
    - uci set dhcp.odhcpd='odhcpd'
    - uci set dhcp.odhcpd.maindhcp='0'
    - uci set dhcp.odhcpd.leasefile='/tmp/hosts/odhcpd'
    - uci set dhcp.odhcpd.leasetrigger='/usr/sbin/odhcpd-update'
    - uci set dhcp.odhcpd.loglevel='4'
    - uci commit dhcp
    - uci add firewall defaults
    - uci set firewall.@defaults[0].syn_flood='1'
    - uci set firewall.@defaults[0].input='REJECT'
    - uci set firewall.@defaults[0].output='ACCEPT'
    - uci set firewall.@defaults[0].forward='REJECT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='lan'
    - uci set firewall.@zone[-1].network='lan'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='ACCEPT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='wan'
    - uci set firewall.@zone[-1].network='wan'
    - uci set firewall.@zone[-1].input='REJECT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci set firewall.@zone[-1].masq='0'
    - uci set firewall.@zone[-1].mtu_fix='1'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='lan'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='caldera'
    - uci set firewall.@zone[-1].network='caldera'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='caldera'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCP-Renew'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='68'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IGMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='igmp'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCPv6'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='546'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-MLD'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].src_ip='fe80::/10'
    - uci add_list firewall.@rule[-1].icmp_type='130/0'
    - uci add_list firewall.@rule[-1].icmp_type='131/0'
    - uci add_list firewall.@rule[-1].icmp_type='132/0'
    - uci add_list firewall.@rule[-1].icmp_type='143/0'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Input'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci add_list firewall.@rule[-1].icmp_type='router-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='router-advertisement'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-advertisement'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Forward'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IPSec-ESP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].proto='esp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ISAKMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].dest_port='500'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci commit firewall
    - /etc/init.d/network restart
    - /etc/init.d/firewall restart
    - /etc/init.d/dnsmasq restart
    - /etc/init.d/odhcpd restart
  - name: Floor4-FW
    commands:
    - uci set system.@system[0].hostname='OpenWrt'
    - uci set system.@system[0].timezone='UTC'
    - uci commit system
    - echo > /etc/config/network
    - echo > /etc/config/firewall
    - echo > /etc/config/dhcp
    - uci set network.loopback='interface'
    - uci set network.loopback.device='lo'
    - uci set network.loopback.proto='static'
    - uci set network.loopback.ipaddr='127.0.0.1'
    - uci set network.loopback.netmask='255.0.0.0'
    - uci set network.globals='globals'
    - uci set network.globals.ula_prefix='fd95:494:7bdf::/48'
    - uci set network.wan='interface'
    - uci set network.wan.ifname='eth0'
    - uci set network.wan.proto='static'
    - uci set network.wan.ipaddr='10.1.4.2'
    - uci set network.wan.netmask='255.255.255.252'
    - uci set network.wan.gateway='10.1.4.1'
    - uci set network.lan='interface'
    - uci set network.lan.ifname='eth1'
    - uci set network.lan.proto='static'
    - uci set network.lan.ipaddr='10.2.4.1'
    - uci set network.lan.netmask='255.255.255.252'
    - uci commit network
    - uci add firewall defaults
    - uci set firewall.@defaults[0].syn_flood='1'
    - uci set firewall.@defaults[0].input='REJECT'
    - uci set firewall.@defaults[0].output='ACCEPT'
    - uci set firewall.@defaults[0].forward='REJECT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='lan'
    - uci set firewall.@zone[-1].network='lan eth0 eth1'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='ACCEPT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='wan'
    - uci add_list firewall.@zone[-1].network='wan'
    - uci set firewall.@zone[-1].input='REJECT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci set firewall.@zone[-1].masq='0'
    - uci set firewall.@zone[-1].mtu_fix='1'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='lan'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci set firewall.caldera='interface'
    - uci set firewall.caldera.ifname='eth1.200'
    - uci set firewall.caldera.proto='static'
    - uci set firewall.caldera.ipaddr='203.0.113.2'
    - uci set firewall.caldera.netmask='255.255.255.0'
    - uci set firewall.caldera.gateway='203.0.113.1'
    - uci set firewall.caldera_zone='zone'
    - uci set firewall.caldera_zone.name='caldera'
    - uci add_list firewall.caldera_zone.network='caldera'
    - uci set firewall.caldera_zone.input='ACCEPT'
    - uci set firewall.caldera_zone.output='ACCEPT'
    - uci set firewall.caldera_zone.forward='REJECT'
    - uci set firewall.caldera_fwd='forwarding'
    - uci set firewall.caldera_fwd.src='caldera'
    - uci set firewall.caldera_fwd.dest='wan'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCP-Renew'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='68'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IGMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='igmp'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCPv6'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='546'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-MLD'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].src_ip='fe80::/10'
    - uci add_list firewall.@rule[-1].icmp_type='130/0'
    - uci add_list firewall.@rule[-1].icmp_type='131/0'
    - uci add_list firewall.@rule[-1].icmp_type='132/0'
    - uci add_list firewall.@rule[-1].icmp_type='143/0'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Input'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci add_list firewall.@rule[-1].icmp_type='router-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='router-advertisement'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-advertisement'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Forward'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IPSec-ESP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].proto='esp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ISAKMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].dest_port='500'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci commit firewall
    - /etc/init.d/network restart
    - /etc/init.d/firewall restart
  - name: Floor4-Router
    commands:
    - uci set system.@system[0].hostname='OpenWrt'
    - uci set system.@system[0].timezone='UTC'
    - uci commit system
    - echo > /etc/config/network
    - echo > /etc/config/firewall
    - echo > /etc/config/dhcp
    - uci set network.loopback='interface'
    - uci set network.loopback.device='lo'
    - uci set network.loopback.proto='static'
    - uci set network.loopback.ipaddr='127.0.0.1'
    - uci set network.loopback.netmask='255.0.0.0'
    - uci set network.globals='globals'
    - uci set network.globals.ula_prefix='fd98:1133:f416::/48'
    - uci set network.vlan100='interface'
    - uci set network.vlan100.ifname='eth1.100'
    - uci set network.vlan100.proto='static'
    - uci set network.vlan100.ipaddr='192.168.100.1'
    - uci set network.vlan100.netmask='255.255.255.0'
    - uci set network.vlan110='interface'
    - uci set network.vlan110.ifname='eth1.110'
    - uci set network.vlan110.proto='static'
    - uci set network.vlan110.ipaddr='192.168.110.1'
    - uci set network.vlan110.netmask='255.255.255.0'
    - uci set network.vlan120='interface'
    - uci set network.vlan120.ifname='eth1.120'
    - uci set network.vlan120.proto='static'
    - uci set network.vlan120.ipaddr='192.168.120.1'
    - uci set network.vlan120.netmask='255.255.255.0'
    - uci set network.wan='interface'
    - uci set network.wan.device='eth0'
    - uci set network.wan.proto='static'
    - uci set network.wan.ipaddr='10.2.4.2'
    - uci set network.wan.netmask='255.255.255.252'
    - uci set network.wan.gateway='10.2.4.1'
    - uci set network.r3link='interface'
    - uci set network.r3link.ifname='eth2'
    - uci set network.r3link.proto='static'
    - uci set network.r3link.ipaddr='10.3.34.2'
    - uci set network.r3link.netmask='255.255.255.252'
    - uci add network route
    - uci set network.@route[-1].target='192.168.10.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].target='192.168.20.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].target='192.168.30.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].target='192.168.40.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].target='192.168.50.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].target='192.168.60.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci set network.@route[-1].interface='r3link'
    - uci add network route
    - uci set network.@route[-1].interface='r3link'
    - uci set network.@route[-1].target='192.168.70.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci add network route
    - uci set network.@route[-1].interface='r3link'
    - uci set network.@route[-1].target='192.168.80.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci add network route
    - uci set network.@route[-1].interface='r3link'
    - uci set network.@route[-1].target='192.168.90.0'
    - uci set network.@route[-1].netmask='255.255.255.0'
    - uci set network.@route[-1].gateway='10.3.34.1'
    - uci commit network
    - uci add dhcp dnsmasq
    - uci set dhcp.@dnsmasq[0].domainneeded='1'
    - uci set dhcp.@dnsmasq[0].boguspriv='1'
    - uci set dhcp.@dnsmasq[0].filterwin2k='0'
    - uci set dhcp.@dnsmasq[0].localise_queries='1'
    - uci set dhcp.@dnsmasq[0].rebind_protection='1'
    - uci set dhcp.@dnsmasq[0].rebind_localhost='1'
    - uci set dhcp.@dnsmasq[0].local='/lan/'
    - uci set dhcp.@dnsmasq[0].domain='lan'
    - uci set dhcp.@dnsmasq[0].expandhosts='1'
    - uci set dhcp.@dnsmasq[0].nonegcache='0'
    - uci set dhcp.@dnsmasq[0].cachesize='1000'
    - uci set dhcp.@dnsmasq[0].authoritative='1'
    - uci set dhcp.@dnsmasq[0].readethers='1'
    - uci set dhcp.@dnsmasq[0].leasefile='/tmp/dhcp.leases'
    - uci set dhcp.@dnsmasq[0].resolvfile='/tmp/resolv.conf.d/resolv.conf.auto'
    - uci set dhcp.@dnsmasq[0].nonwildcard='1'
    - uci set dhcp.@dnsmasq[0].localservice='1'
    - uci set dhcp.@dnsmasq[0].ednspacket_max='1232'
    - uci set dhcp.@dnsmasq[0].filter_aaaa='0'
    - uci set dhcp.@dnsmasq[0].filter_a='0'
    - uci set dhcp.lan='dhcp'
    - uci set dhcp.lan.interface='lan'
    - uci set dhcp.lan.start='100'
    - uci set dhcp.lan.limit='150'
    - uci set dhcp.lan.leasetime='12h'
    - uci set dhcp.lan.dhcpv4='server'
    - uci set dhcp.lan.dhcpv6='server'
    - uci set dhcp.lan.ra='server'
    - uci set dhcp.lan.ra_slaac='1'
    - uci add_list dhcp.lan.ra_flags='managed-config'
    - uci add_list dhcp.lan.ra_flags='other-config'
    - uci set dhcp.wan='dhcp'
    - uci set dhcp.wan.interface='wan'
    - uci set dhcp.wan.ignore='1'
    - uci set dhcp.odhcpd='odhcpd'
    - uci set dhcp.odhcpd.maindhcp='0'
    - uci set dhcp.odhcpd.leasefile='/tmp/hosts/odhcpd'
    - uci set dhcp.odhcpd.leasetrigger='/usr/sbin/odhcpd-update'
    - uci set dhcp.odhcpd.loglevel='4'
    - uci commit dhcp
    - uci add firewall defaults
    - uci set firewall.@defaults[0].syn_flood='1'
    - uci set firewall.@defaults[0].input='REJECT'
    - uci set firewall.@defaults[0].output='ACCEPT'
    - uci set firewall.@defaults[0].forward='REJECT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='lan'
    - uci set firewall.@zone[-1].network='vlan100 vlan110 vlan120 r3link'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='ACCEPT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='wan'
    - uci add_list firewall.@zone[-1].network='wan'
    - uci add_list firewall.@zone[-1].network='wan6'
    - uci set firewall.@zone[-1].input='REJECT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci set firewall.@zone[-1].masq='1'
    - uci set firewall.@zone[-1].mtu_fix='1'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='lan'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCP-Renew'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='68'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-Ping'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].icmp_type='echo-request'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IGMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='igmp'
    - uci set firewall.@rule[-1].family='ipv4'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-DHCPv6'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].dest_port='546'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-MLD'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci set firewall.@rule[-1].src_ip='fe80::/10'
    - uci add_list firewall.@rule[-1].icmp_type='130/0'
    - uci add_list firewall.@rule[-1].icmp_type='131/0'
    - uci add_list firewall.@rule[-1].icmp_type='132/0'
    - uci add_list firewall.@rule[-1].icmp_type='143/0'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Input'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci add_list firewall.@rule[-1].icmp_type='router-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-solicitation'
    - uci add_list firewall.@rule[-1].icmp_type='router-advertisement'
    - uci add_list firewall.@rule[-1].icmp_type='neighbour-advertisement'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ICMPv6-Forward'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='*'
    - uci set firewall.@rule[-1].proto='icmp'
    - uci add_list firewall.@rule[-1].icmp_type='echo-request'
    - uci add_list firewall.@rule[-1].icmp_type='echo-reply'
    - uci add_list firewall.@rule[-1].icmp_type='destination-unreachable'
    - uci add_list firewall.@rule[-1].icmp_type='packet-too-big'
    - uci add_list firewall.@rule[-1].icmp_type='time-exceeded'
    - uci add_list firewall.@rule[-1].icmp_type='bad-header'
    - uci add_list firewall.@rule[-1].icmp_type='unknown-header-type'
    - uci set firewall.@rule[-1].limit='1000/sec'
    - uci set firewall.@rule[-1].family='ipv6'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-IPSec-ESP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].proto='esp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall rule
    - uci set firewall.@rule[-1].name='Allow-ISAKMP'
    - uci set firewall.@rule[-1].src='wan'
    - uci set firewall.@rule[-1].dest='lan'
    - uci set firewall.@rule[-1].dest_port='500'
    - uci set firewall.@rule[-1].proto='udp'
    - uci set firewall.@rule[-1].target='ACCEPT'
    - uci add firewall zone
    - uci set firewall.@zone[-1].name='caldera'
    - uci set firewall.@zone[-1].network='caldera'
    - uci set firewall.@zone[-1].input='ACCEPT'
    - uci set firewall.@zone[-1].output='ACCEPT'
    - uci set firewall.@zone[-1].forward='REJECT'
    - uci add firewall forwarding
    - uci set firewall.@forwarding[-1].src='caldera'
    - uci set firewall.@forwarding[-1].dest='wan'
    - uci commit firewall
    - /etc/init.d/network restart
    - /etc/init.d/firewall restart
    - /etc/init.d/dnsmasq restart
    - /etc/init.d/odhcpd restart
  - name: Floor4-L3SW
    commands:
    - ovs-vsctl set port eth0 trunks=100,110,120
    - ovs-vsctl set port eth1 tag=100
    - ovs-vsctl set port eth2 tag=110
    - ovs-vsctl set port eth3 tag=120
  - name: SwitchX(PoE)
    commands: null
  - name: camera_A_ssh-1
    commands:
    - mkdir -p /etc/network
    - cat > /etc/network/interfaces << 'EOF' auto eth0 iface eth0 inet static address
      192.168.100.10 netmask 255.255.255.0 gateway 192.168.100.1 EOF
    - systemctl restart networking
  - name: Server-Room-SW
    commands: null
  - name: DVR_ssh-1
    commands:
    - mkdir -p /etc/network
    - cat > /etc/network/interfaces << 'EOF' auto eth0 iface eth0 inet static address
      192.168.110.10 netmask 255.255.255.0 gateway 192.168.110.1 EOF
    - systemctl restart networking
  - name: adminPC1-ssh-1
    commands:
    - mkdir -p /etc/network
    - cat > /etc/network/interfaces << 'EOF' auto eth0 iface eth0 inet static address
      192.168.120.10 netmask 255.255.255.0 gateway 192.168.120.1 EOF
    - systemctl restart networking
agents:
  nodes:
  - name: adminPC1-ssh-1
    commands:
    - while ! curl -s $CALDERA_AGENTS_URL 1>/dev/null 2>/dev/null; do echo 'Waiting
      for Caldera ...'; sleep 1; done
    - curl -s -X POST -H "file:sandcat.go" -H "platform:linux" $CALDERA_AGENTS_URL/file/download
      > splunkd
    - chmod +x splunkd
    - ./splunkd -server $CALDERA_AGENTS_URL -group $CALDERA_AGENTS_GROUP_NAME -v &
  - name: camera_A_ssh-1
    commands:
    - while ! curl -s $CALDERA_AGENTS_URL 1>/dev/null 2>/dev/null; do echo 'Waiting
      for Caldera ...'; sleep 1; done
    - curl -s -X POST -H "file:sandcat.go" -H "platform:linux" $CALDERA_AGENTS_URL/file/download
      > splunkd
    - chmod +x splunkd
    - ./splunkd -server $CALDERA_AGENTS_URL -group $CALDERA_AGENTS_GROUP_NAME -v &
  - name: DVR_ssh-1
    commands:
    - while ! curl -s $CALDERA_AGENTS_URL 1>/dev/null 2>/dev/null; do echo 'Waiting
      for Caldera ...'; sleep 1; done
    - curl -s -X POST -H "file:sandcat.go" -H "platform:linux" $CALDERA_AGENTS_URL/file/download
      > splunkd
    - chmod +x splunkd
    - ./splunkd -server $CALDERA_AGENTS_URL -group $CALDERA_AGENTS_GROUP_NAME -v &
facts:
  software:
  - host: camera_A_ssh-1
    software: sshd
    version: ver1
  - host: camera_A_ssh-1
    software: arpd
    version: ver1
  - host: adminPC1-ssh-1
    software: libtasn1_6
    version: v4_16_0_2
  - host: adminPC1-ssh-1
    software: sshd
    version: ver1
  - host: DVR_ssh-1
    software: smbV1
    version: ver1
  - host: FileServer
    software: sftpd
    version: ver1
  vulnerabilities:
  - cve_id: arpSpoofVuln
    software: arpd
    version: ver1
    access_vector: network
    loose_types: caLoss
    severity: critical
  - cve_id: cve_2021_46848
    software: libtasn1_6
    version: v4_16_0_2
    access_vector: network
    loose_types: caLoss
    severity: critical
  - cve_id: cve_2022_2294
    software: libtasn1_6
    version: ver1
    access_vector: network
    loose_types: caLoss
    severity: critical
  - cve_id: cve_2017_0144
    software: smbV1
    version: ver1
    access_vector: network
    loose_types: caLoss
    severity: critical
  - cve_id: sshdSpoofVuln
    software: sshd
    version: ver1
    access_vector: network
    loose_types: caLoss
    severity: critical
  network_services:
  - host: DVR_ssh-1
    software: arpd
    protocol: tcp
    port: Port
    account: root
  - host: DVR_ssh-1
    software: smbV1
    protocol: tcp
    port: '445'
    account: root
  - host: DVR_ssh-1
    software: sshd
    protocol: tcp
    port: Port
    account: root
  - host: FileServer
    software: sftpd
    protocol: tcp
    port: Port
    account: root
  - host: camera_A_ssh-1
    software: arpd
    protocol: tcp
    port: Port
    account: root
  - host: camera_A_ssh-1
    software: sshd
    protocol: tcp
    port: '22'
    account: root
  - host: adminPC1-ssh-1
    software: sshd
    protocol: tcp
    port: '22'
    account: root
  accounts:
  - user: victim
    host: DVR_ssh-1
    account: user
  - user: victim
    host: camera_A_ssh-1
    account: user
  connectivity:
  - src_host: Admin-SW
    dst_host: adminPC1-ssh-1
    protocol: tcp
    dest_port: Port
  - src_host: CoreRouterA
    dst_host: Cloud1
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-FW
    dst_host: CoreRouterE
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-FW
    dst_host: Floor4-Router
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-L3SW
    dst_host: Admin-SW
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-L3SW
    dst_host: DMZ-SW
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-L3SW
    dst_host: Server-Room-SW
    protocol: tcp
    dest_port: Port
  - src_host: Floor4-Router
    dst_host: Floor4-L3SW
    protocol: tcp
    dest_port: Port
  - src_host: Server-Room-SW
    dst_host: DVR_ssh-1
    protocol: tcp
    dest_port: Port
  - src_host: Server-Room-SW
    dst_host: FileServer
    protocol: tcp
    dest_port: Port
  - src_host: SwitchX(PoE)
    dst_host: Floor4-L3SW
    protocol: tcp
    dest_port: Port
  - src_host: camera_A_ssh-1
    dst_host: SwitchX(PoE)
    protocol: tcp
    dest_port: Port
  - src_host: camera_A_ssh-1
    dst_host: DVR_ssh-1
    protocol: tcp
    dest_port: '22'
  - src_host: camera_A_ssh-1
    dst_host: DVR_ssh-1
    protocol: tcp
    dest_port: '445'
  - src_host: Cloud1
    dst_host: adminPC1-ssh-1
    protocol: http
    dest_port: '80'
  - src_host: adminPC1-ssh-1
    dst_host: adminPC1-ssh-1
    protocol: tcp
    dest_port: '22'
  - src_host: adminPC1-ssh-1
    dst_host: camera_A_ssh-1
    protocol: arp
    dest_port: Port
  - src_host: adminPC1-ssh-1
    dst_host: camera_A_ssh-1
    protocol: tcp
    dest_port: '22'
  - src_host: adminPC1-ssh-1
    dst_host: cameraB
    protocol: arp
    dest_port: Port
  - src_host: adminPC1-ssh-1
    dst_host: cameraB
    protocol: tcp
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan100
    protocol: http
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan100
    protocol: smbV1
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan100
    protocol: Protocol
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan110
    protocol: http
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan110
    protocol: sftpd
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan110
    protocol: windowsUAC
    dest_port: Port
  - src_host: vlan120
    dst_host: vlan110
    protocol: Protocol
    dest_port: Port
  network_topology:
  - name: FullBank topology
    definition: 'isInSubnet(''WAN'', ''CoreRouterA'').

      isInSubnet(''core'', ''Floor4-FW'').

      isInSubnet(''floor4'', ''Floor4-L3SW'').

      isInSubnet(''floor4'', ''Floor4-Router'').

      isInSubnet(''vlan100'', ''Floor4-L3SW'').

      isInSubnet(''vlan100'', ''SwitchX(PoE)'').

      isInSubnet(''vlan100'', ''cameraB'').

      isInSubnet(''vlan100'', ''camera_A_ssh-1'').

      isInSubnet(''vlan110'', ''DVR_ssh-1'').

      isInSubnet(''vlan110'', ''FileServer'').

      isInSubnet(''vlan110'', ''Floor4-L3SW'').

      isInSubnet(''vlan110'', ''Server-Room-SW'').

      isInSubnet(''vlan120'', ''Admin-SW'').

      isInSubnet(''vlan120'', ''Floor4-L3SW'').

      isInSubnet(''vlan120'', ''adminPC1-ssh-1'').

      isInSubnet(''vlan120'', ''adminPC2'').

      isInSubnet(''vlan120'', ''adminPC3'').

      isInSubnet(''vlan120'', ''adminPC4'').

      isInSubnet(''vlan120'', ''adminPC5'').

      isInSubnet(''vlan120'', ''adminPC6'').

      '
  goals:
  - name: fullCampaign
    definition: 'attackGoal(fullCampaign(''attacker'', ''adminPC1-ssh-1'', ''camera_A_ssh-1'',
      ''DVR_ssh-1'')).

      '
  access:
  - user: attacker
    attack_source: adminPC1-ssh-1
    host: Floor4-Router
    protocol: tcp
    port: Port
  - user: attacker
    attack_source: adminPC1-ssh-1
    host: adminPC1-ssh-1
    protocol: tcp
    port: '22'
  - user: attacker
    attack_source: adminPC1-ssh-1
    host: camera_A_ssh-1
    protocol: tcp
    port: '22'
  - user: attacker
    attack_source: camera_A_ssh-1
    host: DVR_ssh-1
    protocol: tcp
    port: '445'
  - user: root
    attack_source: adminPC1-ssh-1
    host: camera_A_ssh-1
    protocol: tcp
    port: '22'
  - user: User
    attack_source: adminPC1-ssh-1
    host: cameraB
    protocol: arp
    port: Port
  - user: User
    attack_source: adminPC1-ssh-1
    host: cameraB
    protocol: tcp
    port: Port
  - user: User
    attack_source: adminPC1-ssh-1
    host: camera_A_ssh-1
    protocol: arp
    port: Port
  - user: User
    attack_source: adminPC1-ssh-1
    host: camera_A_ssh-1
    protocol: tcp
    port: '22'
  file_owner:
  - host: DVR_ssh-1
    path: Path
    owner: root
  - host: adminPC1-ssh-1
    path: /etc/shadow
    owner: root
  - host: adminPC1-ssh-1
    path: Path
    owner: root
  - host: camera_A_ssh-1
    path: /etc/shadow
    owner: root
  owner_accessible:
  - host: DVR_ssh-1
    permission: read
    path: Path
  - host: adminPC1-ssh-1
    permission: read
    path: /etc/shadow
  - host: adminPC1-ssh-1
    permission: read
    path: Path
  - host: camera_A_ssh-1
    permission: read
    path: /etc/shadow
  - host: camera_A_ssh-1
    permission: read
    path: Path
  vul_e2e_protocol:
  - fooled_host: DVR_ssh-1
    name_resolver: adminPC1-ssh-1
    attack_type: DNSCachePoisoning
    protocol: DNS
    exploit_range: DNSProt
    lose_types: RemoteExploit
    consequence: NameresolverCachePoisoned
  - fooled_host: camera_A_ssh-1
    name_resolver: adminPC1-ssh-1
    attack_type: DNSCachePoisoning
    protocol: DNS
    exploit_range: DNSProt
    lose_types: RemoteExploit
    consequence: NameresolverCachePoisoned
  device_platforms:
  - host: DVR_ssh-1
    platform: Linux
  - host: adminPC1-ssh-1
    platform: Linux
  - host: camera_A_ssh-1
    platform: Linux
  malicious:
  - user: attacker
  malicious_interaction:
  - host: camera_A_ssh-1
    user: attacker
    software: arpd
  - host: camera_A_ssh-1
    user: attacker
    software: sshd
  - host: cameraB
    user: attacker
    software: _Software
  - host: DVR_ssh-1
    user: attacker
    software: arpd
  - host: DVR_ssh-1
    user: attacker
    software: sshd
  - host: FileServer
    user: attacker
    software: _Software
  - host: adminPC1-ssh-1
    user: attacker
    software: sshd
  data_bind:
  - flow: null
    src_host: camera_A_ssh-1
    path: null
  - flow: null
    src_host: cameraB
    path: null
  - flow: null
    src_host: SwitchX(PoE)
    path: null
  - flow: null
    src_host: Admin-SW
    path: null
  - flow: null
    src_host: adminPC1-ssh-1
    path: null
  - flow: null
    src_host: Server-Room-SW
    path: null
  - flow: null
    src_host: DVR_ssh-1
    path: null
  - flow: null
    src_host: FileServer
    path: null
  - flow: null
    src_host: Floor4-L3SW
    path: null
  - flow: null
    src_host: Floor4-Router
    path: null
  - flow: null
    src_host: CoreRouterC
    path: null
  - flow: null
    src_host: CoreRouterB
    path: null
  - flow: null
    src_host: Cloud1
    path: null
  - flow: null
    src_host: CoreRouterA
    path: null
  - flow: null
    src_host: CoreRouterE
    path: null
  - flow: null
    src_host: Floor4-FW
    path: null
  is_name_resolver:
  - name_resolver: DVR_ssh-1
    fooled_host: camera_A_ssh-1
    impersonated_host: adminPC1-ssh-1
  - name_resolver: camera_A_ssh-1
    fooled_host: DVR_ssh-1
    impersonated_host: adminPC1-ssh-1
